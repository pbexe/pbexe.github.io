Persist=function(){var t,n,a,o,s,l,e="0.1.0";l=function(){var s,e="Thu, 01-Jan-1970 00:00:01 GMT",t=864e5,n=["expires","path","domain"],a=escape,r=unescape,o=document,l=function(){var e=new Date;return e.setTime(e.getTime()),e},u=function(e,t){var i,r,o,s=[],l=arguments.length>2?arguments[2]:{};for(s.push(a(e)+"="+a(t)),i=0;i<n.length;i++)r=n[i],(o=l[r])&&s.push(r+"="+o);return l.secure&&s.push("secure"),s.join("; ")},c=function(){var e="__EC_TEST__",t=new Date;return t=t.toGMTString(),this.set(e,t),this.enabled=this.remove(e)==t,this.enabled};return s={set:function(e,n){var a=arguments.length>2?arguments[2]:{},r=l(),c={};a.expires&&(a.expires*=t,c.expires=new Date(r.getTime()+a.expires),c.expires=c.expires.toGMTString());var f=["path","domain","secure"];for(i=0;i<f.length;i++)a[f[i]]&&(c[f[i]]=a[f[i]]);var d=u(e,n,c);return o.cookie=d,n},has:function(e){e=a(e);var t=o.cookie,i=t.indexOf(e+"="),r=(i+e.length+1,t.substring(0,e.length));return!i&&e!=r||0>i?!1:!0},get:function(e){e=a(e);var l,t=o.cookie,i=t.indexOf(e+"="),n=i+e.length+1,s=t.substring(0,e.length);return!i&&e!=s||0>i?null:(l=t.indexOf(";",n),0>l&&(l=t.length),r(t.substring(n,l)))},remove:function(t){var i=s.get(t),n={expires:e};return o.cookie=u(t,"",n),i},keys:function(){var i,n,e=o.cookie,t=e.split("; "),a=[];for(i=0;i<t.length;i++)n=t[i].split("="),a.push(r(n[0]));return a},all:function(){var i,n,e=o.cookie,t=e.split("; "),a=[];for(i=0;i<t.length;i++)n=t[i].split("="),a.push([r(n[0]),r(n[1])]);return a},version:"0.2.1",enabled:!1},s.enabled=c.call(s),s}(),s=function(){},a=function(e){return"PS"+e.replace(/_/g,"__").replace(/ /g,"_s")},C={search_order:["gears","localstorage","whatwg_db","globalstorage","flash","ie","cookie"],name_re:/^[a-z][a-z0-9_ -]+$/i,methods:["init","get","set","remove","load","save"],sql:{version:"1",create:"CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",get:"SELECT v FROM persist_data WHERE k = ?",set:"INSERT INTO persist_data(k, v) VALUES (?, ?)",remove:"DELETE FROM persist_data WHERE k = ?"},flash:{div_id:"_persist_flash_wrap",id:"_persist_flash",path:"persist.swf",size:{w:1,h:1},args:{autostart:!0}}},n={gears:{size:-1,test:function(){return window.google&&window.google.gears?!0:!1},methods:{transaction:function(e){var t=this.db;t.execute("BEGIN").close(),e.call(this,t),t.execute("COMMIT").close()},init:function(){var e;e=this.db=google.gears.factory.create("beta.database"),e.open(a(this.name)),e.execute(C.sql.create).close()},get:function(e,t,i){var n,a=C.sql.get;t&&this.transaction(function(r){n=r.execute(a,[e]),n.isValidRow()?t.call(i||this,!0,n.field(0)):t.call(i||this,!1,null),n.close()})},set:function(e,t,i,n){var a=C.sql.remove,r=C.sql.set;this.transaction(function(o){o.execute(a,[e]).close(),o.execute(r,[e,t]).close(),i&&i.call(n||this,!0,t)})},remove:function(e,t,i){var n=C.sql.get;sql=C.sql.remove,r,val,this.transaction(function(a){t?(r=a.execute(n,[e]),r.isValidRow()?(val=r.field(0),a.execute(sql,[e]).close(),t.call(i||this,!0,val)):t.call(i||this,!1,null),r.close()):a.execute(sql,[e]).close()})}}},whatwg_db:{size:204800,test:function(){var e="PersistJS Test",t="Persistent database test.";return window.openDatabase&&window.openDatabase(e,C.sql.version,t,n.whatwg_db.size)?!0:!1},methods:{transaction:function(e){if(!this.db_created){var t=C.sql.create;this.db.transaction(function(e){e.executeSql(t,[],function(){this.db_created=!0})},s)}this.db.transaction(e)},init:function(){var e,t;e=this.o.about||"Persistent storage for "+this.name,t=this.o.size||n.whatwg_db.size,this.db=openDatabase(this.name,C.sql.version,e,t)},get:function(e,t,i){var n=C.sql.get;t&&(i=i||this,this.transaction(function(a){a.executeSql(n,[e],function(e,n){n.rows.length>0?t.call(i,!0,n.rows.item(0).v):t.call(i,!1,null)})}))},set:function(e,t,i,n){var a=C.sql.remove,r=C.sql.set;return this.transaction(function(o){o.executeSql(a,[e],function(){o.executeSql(r,[e,t],function(e,a){i&&i.call(n||this,!0,t)})})}),t},remove:function(e,t,i){var n=C.sql.get;sql=C.sql.remove,this.transaction(function(a){t?a.executeSql(n,[e],function(n,a){if(a.rows.length>0){var r=a.rows.item(0).v;n.executeSql(sql,[e],function(e,n){t.call(i||this,!0,r)})}else t.call(i||this,!1,null)}):a.executeSql(sql,[e])})}}},globalstorage:{size:5242880,test:function(){return window.globalStorage?!0:!1},methods:{key:function(e){return a(this.name)+a(e)},init:function(){this.store=globalStorage[this.o.domain]},get:function(e,t,i){e=this.key(e),t&&t.call(i||this,!0,this.store.getItem(e))},set:function(e,t,i,n){e=this.key(e),this.store.setItem(e,t),i&&i.call(n||this,!0,t)},remove:function(e,t,i){var n;e=this.key(e),n=this.store[e],this.store.removeItem(e),t&&t.call(i||this,null!==n,n)}}},localstorage:{size:-1,test:function(){return window.localStorage?!0:!1},methods:{key:function(e){return a(this.name)+a(e)},init:function(){this.store=localStorage},get:function(e,t,i){e=this.key(e),t&&t.call(i||this,!0,this.store.getItem(e))},set:function(e,t,i,n){e=this.key(e),this.store.setItem(e,t),i&&i.call(n||this,!0,t)},remove:function(e,t,i){var n;e=this.key(e),n=this.getItem(e),this.store.removeItem(e),t&&t.call(i||this,null!==n,n)}}},ie:{prefix:"_persist_data-",size:65536,test:function(){return window.ActiveXObject?!0:!1},make_userdata:function(e){var t=document.createElement("div");return t.id=e,t.style.display="none",t.addBehavior("#default#userData"),document.body.appendChild(t),t},methods:{init:function(){var e=n.ie.prefix+a(this.name);this.el=n.ie.make_userdata(e),this.o.defer&&this.load()},get:function(e,t,i){var n;e=a(e),this.o.defer||this.load(),n=this.el.getAttribute(e),t&&t.call(i||this,n?!0:!1,n)},set:function(e,t,i,n){e=a(e),this.el.setAttribute(e,t),this.o.defer||this.save(),i&&i.call(n||this,!0,t)},load:function(){this.el.load(a(this.name))},save:function(){this.el.save(a(this.name))}}},cookie:{delim:":",size:4e3,test:function(){return t.Cookie.enabled?!0:!1},methods:{key:function(e){return this.name+n.cookie.delim+e},get:function(e,t,i,n){e=this.key(e),t=l.get(e),i&&i.call(n||this,null!=t,t)},set:function(e,t,i,n){e=this.key(e),l.set(e,t,this.o),i&&i.call(n||this,!0,t)},remove:function(e,t,i,n){var t;e=this.key(e),t=l.remove(e),i&&i.call(n||this,null!=t,t)}}},flash:{test:function(){if(!window.SWFObject||!deconcept||!deconcept.SWFObjectUtil)return!1;var e=deconcept.SWFObjectUtil.getPlayerVersion().major;return e>=8?!0:!1},methods:{init:function(){if(!n.flash.el){var e,t,i,a=C.flash;i=document.createElement("div"),i.id=a.div_id,document.body.appendChild(i),e=new SWFObject(this.o.swf_path||a.path,a.id,a.size.w,a.size.h,"8");for(t in a.args)e.addVariable(t,a.args[t]);e.write(i),n.flash.el=document.getElementById(a.id)}this.el=n.flash.el},get:function(e,t,i){var n;e=a(e),n=this.el.get(this.name,e),t&&t.call(i||this,null!==n,n)},set:function(e,t,i,n){var r;e=a(e),r=this.el.set(this.name,e,t),i&&i.call(n||this,!0,t)},remove:function(e,t,i){var n;e=a(e),n=this.el.remove(this.name,e),t&&t.call(i||this,!0,n)}}}};var o=function(){var e,i,a,r,o=C.methods,l=C.search_order;for(e=0,i=o.length;i>e;e++)t.Store.prototype[o[e]]=s;for(t.type=null,t.size=-1,e=0,i=l.length;!t.type&&i>e;e++)if(a=n[l[e]],a.test()){t.type=l[e],t.size=a.size;for(r in a.methods)t.Store.prototype[r]=a.methods[r]}t._init=!0};return t={VERSION:e,type:null,size:0,add:function(e){n[e.id]=e,C.search_order=[e.id].concat(C.search_order),o()},remove:function(e){var t=C.search_order.indexOf(e);0>t||(C.search_order.splice(t,1),delete n[e],o())},Cookie:l,Store:function(e,i){if(!C.name_re.exec(e))throw new Error("Invalid name");if(!t.type)throw new Error("No suitable storage found");i=i||{},this.name=e,i.domain=i.domain||location.hostname||"localhost.localdomain",this.o=i,i.expires=i.expires||730,i.path=i.path||"/",this.init()}},o(),t}();