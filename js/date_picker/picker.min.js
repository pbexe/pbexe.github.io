!function(e){"function"==typeof define&&define.amd?define("picker",["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):this.Picker=e(jQuery)}(function(e){function r(t,l,c,d){function b(){return r._.node("div",r._.node("div",r._.node("div",r._.node("div",g.component.nodes(h.open),m.box),m.wrap),m.frame),m.holder)}function k(){y.data(l,g).addClass(m.input).attr("tabindex",-1).val(y.data("value")?g.get("select",p.format):t.value),p.editable||y.on("focus."+h.id+" click."+h.id,function(e){e.preventDefault(),g.$root[0].focus()}).on("keydown."+h.id,x),s(t,{haspopup:!0,expanded:!1,readonly:!1,owns:t.id+"_root"})}function w(){g.$root.on({keydown:x,focusin:function(e){g.$root.removeClass(m.focused),e.stopPropagation()},"mousedown click":function(t){var n=t.target;n!=g.$root.children()[0]&&(t.stopPropagation(),"mousedown"!=t.type||e(n).is("input, select, textarea, button, option")||(t.preventDefault(),g.$root[0].focus()))}}).on({focus:function(){y.addClass(m.target)},blur:function(){y.removeClass(m.target)}}).on("focus.toOpen",$).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var t=e(this),n=t.data(),i=t.hasClass(m.navDisabled)||t.hasClass(m.disabled),r=u();r=r&&(r.type||r.href),(i||r&&!e.contains(g.$root[0],r))&&g.$root[0].focus(),!i&&n.nav?g.set("highlight",g.component.item.highlight,{nav:n.nav}):!i&&"pick"in n?g.set("select",n.pick):n.clear?g.clear().close(!0):n.close&&g.close(!0)}),s(g.$root[0],"hidden",!0)}function _(){var n;p.hiddenName===!0?(n=t.name,t.name=""):(n=["string"==typeof p.hiddenPrefix?p.hiddenPrefix:"","string"==typeof p.hiddenSuffix?p.hiddenSuffix:"_submit"],n=n[0]+t.name+n[1]),g._hidden=e('<input type=hidden name="'+n+'"'+(y.data("value")||t.value?' value="'+g.get("select",p.formatSubmit)+'"':"")+">")[0],y.on("change."+h.id,function(){g._hidden.value=t.value?g.get("select",p.formatSubmit):""}),p.container?e(p.container).append(g._hidden):y.after(g._hidden)}function x(e){var t=e.keyCode,n=/^(8|46)$/.test(t);return 27==t?(g.close(),!1):void((32==t||n||!h.open&&g.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?g.clear().close():g.open()))}function $(e){e.stopPropagation(),"focus"==e.type&&g.$root.addClass(m.focused),g.open()}if(!t)return r;var f=!1,h={id:t.id||"P"+Math.abs(~~(Math.random()*new Date))},p=c?e.extend(!0,{},c.defaults,d):d||{},m=e.extend({},r.klasses(),p.klass),y=e(t),v=function(){return this.start()},g=v.prototype={constructor:v,$node:y,start:function(){return h&&h.start?g:(h.methods={},h.start=!0,h.open=!1,h.type=t.type,t.autofocus=t==u(),t.readOnly=!p.editable,t.id=t.id||h.id,"text"!=t.type&&(t.type="text"),g.component=new c(g,p),g.$root=e(r._.node("div",b(),m.picker,'id="'+t.id+'_root" tabindex="0"')),w(),p.formatSubmit&&_(),k(),p.container?e(p.container).append(g.$root):y.after(g.$root),g.on({start:g.component.onStart,render:g.component.onRender,stop:g.component.onStop,open:g.component.onOpen,close:g.component.onClose,set:g.component.onSet}).on({start:p.onStart,render:p.onRender,stop:p.onStop,open:p.onOpen,close:p.onClose,set:p.onSet}),f=a(g.$root.children()[0]),t.autofocus&&g.open(),g.trigger("start").trigger("render"))},render:function(e){return e?g.$root.html(b()):g.$root.find("."+m.box).html(g.component.nodes(h.open)),g.trigger("render")},stop:function(){return h.start?(g.close(),g._hidden&&g._hidden.parentNode.removeChild(g._hidden),g.$root.remove(),y.removeClass(m.input).removeData(l),setTimeout(function(){y.off("."+h.id)},0),t.type=h.type,t.readOnly=!1,g.trigger("stop"),h.methods={},h.start=!1,g):g},open:function(a){return h.open?g:(y.addClass(m.active),s(t,"expanded",!0),setTimeout(function(){g.$root.addClass(m.opened),s(g.$root[0],"hidden",!1)},0),a!==!1&&(h.open=!0,f&&i.css("overflow","hidden").css("padding-right","+="+o()),g.$root[0].focus(),n.on("click."+h.id+" focusin."+h.id,function(e){var n=e.target;n!=t&&n!=document&&3!=e.which&&g.close(n===g.$root.children()[0])}).on("keydown."+h.id,function(t){var n=t.keyCode,i=g.component.key[n],a=t.target;27==n?g.close(!0):a!=g.$root[0]||!i&&13!=n?e.contains(g.$root[0],a)&&13==n&&(t.preventDefault(),a.click()):(t.preventDefault(),i?r._.trigger(g.component.key.go,g,[r._.trigger(i)]):g.$root.find("."+m.highlighted).hasClass(m.disabled)||g.set("select",g.component.item.highlight).close())})),g.trigger("open"))},close:function(e){return e&&(g.$root.off("focus.toOpen")[0].focus(),setTimeout(function(){g.$root.on("focus.toOpen",$)},0)),y.removeClass(m.active),s(t,"expanded",!1),setTimeout(function(){g.$root.removeClass(m.opened+" "+m.focused),s(g.$root[0],"hidden",!0)},0),h.open?(h.open=!1,f&&i.css("overflow","").css("padding-right","-="+o()),n.off("."+h.id),g.trigger("close")):g},clear:function(e){return g.set("clear",null,e)},set:function(t,n,i){var r,a,o=e.isPlainObject(t),s=o?t:{};if(i=o&&e.isPlainObject(n)?n:i||{},t){o||(s[t]=n);for(r in s)a=s[r],r in g.component.item&&(void 0===a&&(a=null),g.component.set(r,a,i)),("select"==r||"clear"==r)&&y.val("clear"==r?"":g.get(r,p.format)).trigger("change");g.render()}return i.muted?g:g.trigger("set",s)},get:function(e,n){if(e=e||"value",null!=h[e])return h[e];if("valueSubmit"==e){if(g._hidden)return g._hidden.value;e="value"}if("value"==e)return t.value;if(e in g.component.item){if("string"==typeof n){var i=g.component.get(e);return i?r._.trigger(g.component.formats.toString,g.component,[n,i]):""}return g.component.get(e)}},on:function(t,n,i){var r,a,o=e.isPlainObject(t),s=o?t:{};if(t){o||(s[t]=n);for(r in s)a=s[r],i&&(r="_"+r),h.methods[r]=h.methods[r]||[],h.methods[r].push(a)}return g},off:function(){var e,t,n=arguments;for(e=0,namesCount=n.length;e<namesCount;e+=1)t=n[e],t in h.methods&&delete h.methods[t];return g},trigger:function(e,t){var n=function(e){var n=h.methods[e];n&&n.map(function(e){r._.trigger(e,g,[t])})};return n("_"+e),n(e),g}};return new v}function a(e){var t,n="position";return e.currentStyle?t=e.currentStyle[n]:window.getComputedStyle&&(t=getComputedStyle(e)[n]),"fixed"==t}function o(){if(i.height()<=t.height())return 0;var n=e('<div style="visibility:hidden;width:100px" />').appendTo("body"),r=n[0].offsetWidth;n.css("overflow","scroll");var a=e('<div style="width:100%" />').appendTo(n),o=a[0].offsetWidth;return n.remove(),r-o}function s(t,n,i){if(e.isPlainObject(n))for(var r in n)l(t,r,n[r]);else l(t,n,i)}function l(e,t,n){e.setAttribute(("role"==t?"":"aria-")+t,n)}function c(t,n){e.isPlainObject(t)||(t={attribute:n}),n="";for(var i in t){var r=("role"==i?"":"aria-")+i,a=t[i];n+=null==a?"":r+'="'+t[i]+'"'}return n}function u(){try{return document.activeElement}catch(e){}}var t=e(window),n=e(document),i=e(document.documentElement);return r.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",target:e+"__input--target",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},r._={group:function(e){for(var t,n="",i=r._.trigger(e.min,e);i<=r._.trigger(e.max,e,[i]);i+=e.i)t=r._.trigger(e.item,e,[i]),n+=r._.node(e.node,t[0],t[1],t[2]);return n},node:function(t,n,i,r){return n?(n=e.isArray(n)?n.join(""):n,i=i?' class="'+i+'"':"",r=r?" "+r:"","<"+t+i+r+">"+n+"</"+t+">"):""},lead:function(e){return(10>e?"0":"")+e},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1&&this.isInteger(e.getDate())},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&e%1===0},ariaAttr:c},r.extend=function(t,n){e.fn[t]=function(i,a){var o=this.data(t);return"picker"==i?o:o&&"string"==typeof i?r._.trigger(o[i],o,[a]):this.each(function(){var a=e(this);a.data(t)||new r(this,t,n,i)})},e.fn[t].defaults=n.defaults},r});